var Colyseus=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=18)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),o=n(26);t.decode=r,t.encode=o},function(e,t,n){"use strict";function r(e,t){for(var n=e.getUint8(t++),r="",o=0,i=t,s=t+n;i<s;i++){var a=e.getUint8(i);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));o=(7&a)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0,o>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0);else r+=String.fromCharCode((31&a)<<6|63&e.getUint8(++i));else r+=String.fromCharCode(a)}return r}function o(e){void 0===e&&(e="");for(var t=0,n=0,r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n+1}Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.USER_ID=1]="USER_ID",e[e.JOIN_REQUEST=9]="JOIN_REQUEST",e[e.JOIN_ROOM=10]="JOIN_ROOM",e[e.JOIN_ERROR=11]="JOIN_ERROR",e[e.LEAVE_ROOM=12]="LEAVE_ROOM",e[e.ROOM_DATA=13]="ROOM_DATA",e[e.ROOM_STATE=14]="ROOM_STATE",e[e.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",e[e.ROOM_LIST=20]="ROOM_LIST",e[e.BAD_REQUEST=50]="BAD_REQUEST"}(t.Protocol||(t.Protocol={})),t.utf8Read=r,t.utf8Length=o},function(e,t){function n(e,t){return l.call(e,t)}function r(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var t=[];for(var o in e)n(e,o)&&t.push(o);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function i(e){for(var t,n=0,r=e.length;n<r;){t=e.charCodeAt(n);{if(!(t>=48&&t<=57))return!1;n++}}return!0}function s(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function a(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function u(e,t){var r;for(var o in e)if(n(e,o)){if(e[o]===t)return s(o)+"/";if("object"==typeof e[o]&&""!=(r=u(e[o],t)))return s(o)+"/"+r}return""}function c(e,t){if(e===t)return"/";var n=u(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n}function f(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(f(e[t]))return!0}else if("object"==typeof e)for(var o=r(e),i=o.length,t=0;t<i;t++)if(f(e[o[t]]))return!0;return!1}var h=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},l=Object.prototype.hasOwnProperty;t.hasOwnProperty=n,t._objectKeys=r,t._deepClone=o,t.isInteger=i,t.escapePathComponent=s,t.unescapePathComponent=a,t._getPathRecursive=u,t.getPath=c,t.hasUndefined=f;var p=function(e){function t(t,n,r,o,i){e.call(this,t),this.message=t,this.name=n,this.index=r,this.operation=o,this.tree=i}return h(t,e),t}(Error);t.PatchError=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t.OnceSignal=r.OnceSignal;var o=n(21);t.Signal=o.Signal;var i=n(6);t.Slot=i.Slot;var s=n(5);t.SlotList=s.SlotList},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),o=n(6),i=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.slots=r.SlotList.NIL,this.valueClasses=1===e.length&&e[0]instanceof Array?e[0]:e}return Object.defineProperty(e.prototype,"valueClasses",{get:function(){return this._valueClasses},set:function(e){this._valueClasses=e?e.slice():[];for(var t=this._valueClasses.length;t--;)if(!(this._valueClasses[t]instanceof Object))throw new Error("Invalid valueClasses argument: item at index "+t+" should be a Class but was:<"+this._valueClasses[t]+">."+this._valueClasses[t])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numListeners",{get:function(){return this.slots.length},enumerable:!0,configurable:!0}),e.prototype.addOnce=function(e){return this.registerListener(e,!0)},e.prototype.once=function(e){return this.addOnce(e)},e.prototype.remove=function(e){var t=this.slots.find(e);return t?(this.slots=this.slots.filterNot(e),t):null},e.prototype.removeAll=function(){this.slots=r.SlotList.NIL},e.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._valueClasses.length,r=e.length;if(r<n)throw new Error("Incorrect number of arguments. Expected at least "+n+" but received "+r+".");for(var o=0;o<n;o++)if(!(null===e[o]||e[o]instanceof this._valueClasses[o]||e[o].constructor===this._valueClasses[o]))throw new Error("Value object <"+e[o]+"> is not an instance of <"+this._valueClasses[o]+">.");var i=this.slots;if(i.nonEmpty)for(;i.nonEmpty;)i.head.execute(e),i=i.tail},e.prototype.registerListener=function(e,t){if(void 0===t&&(t=!1),this.registrationPossible(e,t)){var n=new o.Slot(e,this,t);return this.slots=this.slots.prepend(n),n}return this.slots.find(e)},e.prototype.registrationPossible=function(e,t){if(!this.slots.nonEmpty)return!0;var n=this.slots.find(e);if(!n)return!0;if(n.once!==t)throw new Error("You cannot addOnce() then add() the same listener without removing the relationship first.");return!1},e}();t.OnceSignal=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t,n){if(void 0===n&&(n=null),this.nonEmpty=!1,t||n){if(!t)throw new Error("Parameter head cannot be null.");this.head=t,this.tail=n||e.NIL,this.nonEmpty=!0}else{if(e.NIL)throw new Error("Parameters head and tail are null. Use the NIL element instead.");this.nonEmpty=!1}}return Object.defineProperty(e.prototype,"length",{get:function(){if(!this.nonEmpty)return 0;if(this.tail===e.NIL)return 1;for(var t=0,n=this;n.nonEmpty;)++t,n=n.tail;return t},enumerable:!0,configurable:!0}),e.prototype.prepend=function(t){return new e(t,this)},e.prototype.append=function(t){if(!t)return this;if(!this.nonEmpty)return new e(t);if(this.tail===e.NIL)return new e(t).prepend(this.head);for(var n=new e(this.head),r=n,o=this.tail;o.nonEmpty;)r=r.tail=new e(o.head),o=o.tail;return r.tail=new e(t),n},e.prototype.insertWithPriority=function(t){if(!this.nonEmpty)return new e(t);var n=t.priority;if(n>this.head.priority)return this.prepend(t);for(var r=new e(this.head),o=r,i=this.tail;i.nonEmpty;){if(n>i.head.priority)return o.tail=i.prepend(t),r;o=o.tail=new e(i.head),i=i.tail}return o.tail=new e(t),r},e.prototype.filterNot=function(t){if(!this.nonEmpty||null==t)return this;if(t===this.head.listener)return this.tail;for(var n=new e(this.head),r=n,o=this.tail;o.nonEmpty;){if(o.head.listener===t)return r.tail=o.tail,n;r=r.tail=new e(o.head),o=o.tail}return this},e.prototype.contains=function(e){if(!this.nonEmpty)return!1;for(var t=this;t.nonEmpty;){if(t.head.listener===e)return!0;t=t.tail}return!1},e.prototype.find=function(e){if(!this.nonEmpty)return null;for(var t=this;t.nonEmpty;){if(t.head.listener===e)return t.head;t=t.tail}return null},e.prototype.toString=function(){for(var e="",t=this;t.nonEmpty;)e+=t.head+" -> ",t=t.tail;return"[List "+(e+="NIL")+"]"},e.NIL=new e(null,null),e}();t.SlotList=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=0),this._enabled=!0,this._once=!1,this._priority=0,this._listener=e,this._once=n,this._signal=t,this._priority=r,this.verifyListener(e)}return e.prototype.execute0=function(){if(this._enabled){if(this._once&&this.remove(),this._params&&this._params.length)return void this._listener.apply(null,this._params);this._listener()}},e.prototype.execute1=function(e){if(this._enabled){if(this._once&&this.remove(),this._params&&this._params.length)return void this._listener.apply(null,[e].concat(this._params));this._listener(e)}},e.prototype.execute=function(e){if(this._enabled){this._once&&this.remove(),this._params&&this._params.length&&(e=e.concat(this._params));var t=e.length;0===t?this._listener():1===t?this._listener(e[0]):2===t?this._listener(e[0],e[1]):3===t?this._listener(e[0],e[1],e[2]):this._listener.apply(null,e)}},Object.defineProperty(e.prototype,"listener",{get:function(){return this._listener},set:function(e){if(null==e)throw new Error("Given listener is null.\nDid you want to set enabled to false instead?");this.verifyListener(e),this._listener=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"once",{get:function(){return this._once},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"[Slot listener: "+this._listener+", once: "+this._once+", priority: "+this._priority+", enabled: "+this._enabled+"]"},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"params",{get:function(){return this._params},set:function(e){this._params=e},enumerable:!0,configurable:!0}),e.prototype.remove=function(){this._signal.remove(this._listener)},e.prototype.verifyListener=function(e){if(null==e)throw new Error("Given listener is null.");if(null==this._signal)throw new Error("Internal signal reference has not been set yet.")},e}();t.Slot=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),i=n(0),s=function(e){function t(t,n){void 0===n&&(n=!0);var r=e.call(this,t,void 0,{connect:n})||this;return r._enqueuedCalls=[],r}return r(t,e),t.prototype.onOpenCallback=function(t){if(e.prototype.onOpenCallback.call(this),this.binaryType="arraybuffer",this._enqueuedCalls.length>0){for(var n=0,r=this._enqueuedCalls;n<r.length;n++){var o=r[n],i=o[0],s=o[1];this[i].apply(this,s)}this._enqueuedCalls=[]}},t.prototype.send=function(t){if(this.ws.readyState===o.default.OPEN)return e.prototype.send.call(this,i.encode(t));this._enqueuedCalls.push(["send",[t]])},t}(o.default);t.Connection=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(0),i=n(7),s=n(9),a=n(1),u=function(){function e(e,t){var n=this;this.onJoin=new r.Signal,this.onStateChange=new r.Signal,this.onMessage=new r.Signal,this.onError=new r.Signal,this.onLeave=new r.Signal,this.id=null,this.name=e,this.options=t,this.onLeave.add(function(){return n.removeAllListeners()})}return e.prototype.connect=function(e){var t=this;this.connection=new i.Connection(e,!1),this.connection.reconnectEnabled=!1,this.connection.onmessage=this.onMessageCallback.bind(this),this.connection.onclose=function(e){return t.onLeave.dispatch(e)},this.connection.onerror=function(e){console.warn("Possible causes: room's onAuth() failed or maxClients has been reached."),t.onError.dispatch(e)},this.connection.open()},e.prototype.leave=function(){this.connection?this.connection.send([a.Protocol.LEAVE_ROOM]):this.onLeave.dispatch()},e.prototype.send=function(e){this.connection.send([a.Protocol.ROOM_DATA,this.id,e])},Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasJoined",{get:function(){return void 0!==this.sessionId},enumerable:!0,configurable:!0}),e.prototype.listen=function(e,t,n){return"schema"===this.serializerId?void console.error("'"+this.serializerId+"' serializer doesn't support .listen() method."):this.serializer.api.listen(e,t,n)},e.prototype.removeAllListeners=function(){this.serializer.removeAllListeners&&this.serializer.removeAllListeners(),this.onJoin.removeAll(),this.onStateChange.removeAll(),this.onMessage.removeAll(),this.onError.removeAll(),this.onLeave.removeAll()},e.prototype.onMessageCallback=function(e){if(this.previousCode)this.previousCode===a.Protocol.ROOM_STATE?this.setState(Array.from(new Uint8Array(e.data))):this.previousCode===a.Protocol.ROOM_STATE_PATCH?this.patch(Array.from(new Uint8Array(e.data))):this.previousCode===a.Protocol.ROOM_DATA&&this.onMessage.dispatch(o.decode(e.data)),this.previousCode=void 0;else{var t=new DataView(e.data),n=t.getUint8(0);if(n===a.Protocol.JOIN_ROOM){var r=1;this.sessionId=a.utf8Read(t,r),r+=a.utf8Length(this.sessionId),this.serializerId=a.utf8Read(t,r),r+=a.utf8Length(this.serializerId);var i=s.getSerializer(this.serializerId);if(!i)throw new Error("missing serializer: "+this.serializerId);if(this.serializer=new i,this.serializer.handshake){var u=Array.from(new Uint8Array(t.buffer.slice(r)));this.serializer.handshake(u)}this.onJoin.dispatch()}else n===a.Protocol.JOIN_ERROR?this.onError.dispatch(a.utf8Read(t,1)):n===a.Protocol.LEAVE_ROOM?this.leave():this.previousCode=n}},e.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.dispatch(this.serializer.getState())},e.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.dispatch(this.serializer.getState())},e}();t.Room=u},function(e,t,n){"use strict";function r(e,t){i[e]=t}function o(e){return i[e]}Object.defineProperty(t,"__esModule",{value:!0});var i={};t.registerSerializer=r,t.getSerializer=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29);t.StateContainer=r.StateContainer},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12);t.MapSchema=r.MapSchema;var o=n(13);t.ArraySchema=o.ArraySchema;var i=n(33);t.Schema=i.Schema,t.type=i.type,t.Reflection=i.Reflection,t.ReflectionType=i.ReflectionType,t.ReflectionField=i.ReflectionField},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(t){void 0===t&&(t={});var n=this;for(var r in t)this[r]=t[r];Object.defineProperties(this,{onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},clone:{value:function(){var t=Object.assign(new e,n);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t}},_indexes:{value:{},enumerable:!1,writable:!0},_updateIndexes:{value:function(){var e=0,t={};for(var r in n)t[r]=e++;n._indexes=t}}})}return e}();t.MapSchema=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=e.apply(this,n)||this;return Object.setPrototypeOf(o,Object.create(t.prototype)),Object.defineProperties(o,{onAdd:{value:void 0,enumerable:!1,writable:!0},onRemove:{value:void 0,enumerable:!1,writable:!0},onChange:{value:void 0,enumerable:!1,writable:!0},clone:{value:function(){var e=new(t.bind.apply(t,[void 0].concat(o)));return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e}}}),o}return r(t,e),Object.defineProperty(t,Symbol.species,{get:function(){return Array},enumerable:!0,configurable:!0}),t}(Array);t.ArraySchema=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.END_OF_STRUCTURE=193,t.NIL=192,t.INDEX_CHANGE=212},function(e,t,n){function r(e){return null===e||void 0===e}function o(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}function i(e,t,n){var i,f;if(r(e)||r(t))return!1;if(e.prototype!==t.prototype)return!1;if(u(e))return!!u(t)&&(e=s.call(e),t=s.call(t),c(e,t,n));if(o(e)){if(!o(t))return!1;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}try{var h=a(e),l=a(t)}catch(e){return!1}if(h.length!=l.length)return!1;for(h.sort(),l.sort(),i=h.length-1;i>=0;i--)if(h[i]!=l[i])return!1;for(i=h.length-1;i>=0;i--)if(f=h[i],!c(e[f],t[f],n))return!1;return typeof e==typeof t}var s=Array.prototype.slice,a=n(38),u=n(39),c=e.exports=function(e,t,n){return n||(n={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?n.strict?e===t:e==t:i(e,t,n))}},function(e,t,n){function r(e,t){if(""==t)return e;var n={op:"_get",path:t};return o(e,n),n.value}function o(e,n,o,i){if(void 0===o&&(o=!1),void 0===i&&(i=!0),o&&("function"==typeof o?o(n,0,e,n.path):a(n,0)),""===n.path){var s={newDocument:e};if("add"===n.op)return s.newDocument=n.value,s;if("replace"===n.op)return s.newDocument=n.value,s.removed=e,s;if("move"===n.op||"copy"===n.op)return s.newDocument=r(e,n.from),"move"===n.op&&(s.removed=e),s;if("test"===n.op){if(s.test=h(e,n.value),!1===s.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,n,e);return s.newDocument=e,s}if("remove"===n.op)return s.removed=e,s.newDocument=null,s;if("_get"===n.op)return n.value=e,s;if(o)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,n,e);return s}i||(e=l._deepClone(e));var u=n.path||"",c=u.split("/"),f=e,v=1,y=c.length,_=void 0,m=void 0,g=void 0;for(g="function"==typeof o?o:a;;){if(m=c[v],o&&void 0===_&&(void 0===f[m]?_=c.slice(0,v).join("/"):v==y-1&&(_=n.path),void 0!==_&&g(n,0,e,_)),v++,Array.isArray(f)){if("-"===m)m=f.length;else{if(o&&!l.isInteger(m))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,n.path,n);l.isInteger(m)&&(m=~~m)}if(v>=y){if(o&&"add"===n.op&&m>f.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,n.path,n);var s=d[n.op].call(n,f,m,e);if(!1===s.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,n,e);return s}}else if(m&&-1!=m.indexOf("~")&&(m=l.unescapePathComponent(m)),v>=y){var s=p[n.op].call(n,f,m,e);if(!1===s.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,n,e);return s}f=f[m]}}function i(e,n,r,i){if(void 0===i&&(i=!0),r&&!Array.isArray(n))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=l._deepClone(e));for(var s=new Array(n.length),a=0,u=n.length;a<u;a++)s[a]=o(e,n[a],r),e=s[a].newDocument;return s.newDocument=e,s}function s(e,n){var r=o(e,n);if(!1===r.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,n,e);return r.newDocument}function a(e,n,r,o){if("object"!=typeof e||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,e,r);if(!p[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,e,r);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,e,r);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&l.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,e,r);if(r)if("add"==e.op){var i=e.path.split("/").length,s=o.split("/").length;if(i!==s+1&&i!==s)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==o)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,e,r)}else if("move"===e.op||"copy"===e.op){var a={op:"_get",path:e.from,value:void 0},c=u([a],r);if(c&&"OPERATION_PATH_UNRESOLVABLE"===c.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,e,r)}}function u(e,n,r){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(n)i(l._deepClone(n),l._deepClone(e),r||!0);else{r=r||a;for(var o=0;o<e.length;o++)r(e[o],o,n,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}var c={strict:!0},f=n(15),h=function(e,t){return f(e,t,c)},l=n(2);t.JsonPatchError=l.PatchError,t.deepClone=l._deepClone;var p={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var i=r(n,this.path);i&&(i=l._deepClone(i));var s=o(n,{op:"remove",path:this.from}).removed;return o(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=r(n,this.from);return o(n,{op:"add",path:this.path,value:l._deepClone(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:h(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},d={add:function(e,t,n){return l.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:p.move,copy:p.copy,test:p.test,_get:p._get};t.getValueByPointer=r,t.applyOperation=o,t.applyPatch=i,t.applyReducer=s,t.validator=a,t.validate=u},function(e,t,n){"use strict";function r(e,t){l(e,t,t)}function o(e,t,n){return f(e,"map",t,n)}function i(e,t,n){return f(e,"object",t,n)}function s(e,t,n){return f(e,"var")}function a(e,t,n){return f(e,"list",t,n)}function u(){return f(void 0,"key")}function c(){return function(e,t){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return e.constructor.$room}})}}function f(e,t,n,r){return void 0===t&&(t="var"),function(o,i){o.constructor.properties||(o.constructor.properties={});var s=i;"string"==typeof e&&(s=i,i=e,e=void 0),o.constructor.properties[i]={addCallback:n,holderType:t,removeCallback:r,type:e,variable:s}}}function h(e,t){return function(n,r,o){n.constructor.listeners||(n.constructor.listeners={}),n.constructor.listeners[e]={methodName:r,op:t}}}function l(e,t,n,r){p(t.constructor.properties||t.properties,e,t,n,r),d(t.constructor.listeners,e,t)}function p(e,t,n,r,o){if(e){Object.defineProperty(n,"$room",{configurable:!0,enumerable:!1,value:t,writable:!0}),n.$room=t;for(var i in e)if(e.hasOwnProperty(i)){var s=e[i],a=o?o+"/"+i:i;if("map"===s.holderType&&(a+="/:id"),y[a])return;y[a]=!0;var u=v[s.holderType+"Listener"];u&&(t.listen(a,u(t,s,n,r,a)),s.type&&l(t,s.type,n,a))}}}function d(e,t,n){if(e){for(var r in e)!function(r){if(!e.hasOwnProperty(r))return"continue";var o=e[r],i=o.op?function(e){e.operation===o.op&&n[o.methodName](e)}:n[o.methodName].bind(n);t.listen(r,i)}(r)}}Object.defineProperty(t,"__esModule",{value:!0});var v=n(40);t.initializeSync=r,t.syncMap=o,t.syncObject=i,t.syncVar=s,t.syncList=a,t.key=u,t.room=c,t.sync=f,t.listen=h;var y={};t.createBindings=l,t.bindListeners=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(19);var r=n(20);t.Client=r.Client;var o=n(1);t.Protocol=o.Protocol;var i=n(8);t.Room=i.Room;var s=n(28);t.FossilDeltaSerializer=s.FossilDeltaSerializer;var a=n(32);t.SchemaSerializer=a.SchemaSerializer;var u=n(36);t.JSONPatchSerializer=u.JSONPatchSerializer;var c=n(9);t.registerSerializer=c.registerSerializer;var f=n(11);t.Schema=f.Schema,t.type=f.type,c.registerSerializer("fossil-delta",s.FossilDeltaSerializer),c.registerSerializer("json-patch",u.JSONPatchSerializer),c.registerSerializer("schema",a.SchemaSerializer);var h=n(17);t.initializeSync=h.initializeSync,t.sync=h.sync,t.syncMap=h.syncMap,t.syncObject=h.syncObject,t.syncVar=h.syncVar,t.syncList=h.syncList,t.key=h.key,t.room=h.room,t.listen=h.listen},function(e,t){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(7),i=n(1),s=n(8),a=n(27),u=function(){function e(e,t){void 0===t&&(t={});var n=this;this.onOpen=new r.Signal,this.onClose=new r.Signal,this.onError=new r.Signal,this.rooms={},this.connectingRooms={},this.requestId=0,this.roomsAvailableRequests={},this.hostname=e,a.getItem("colyseusid",function(e){return n.connect(e,t)})}return e.prototype.join=function(e,t){return void 0===t&&(t={}),this.createRoomRequest(e,t)},e.prototype.rejoin=function(e,t){if(!t.sessionId)throw new Error("'sessionId' options is required for 'rejoin'.");return this.join(e,t)},e.prototype.getAvailableRooms=function(e,t){var n=this,r=++this.requestId,o=function(){return delete n.roomsAvailableRequests[r]},s=setTimeout(function(){o(),t([],"timeout")},1e4);this.connection.send([i.Protocol.ROOM_LIST,r,e]),this.roomsAvailableRequests[r]=function(e){o(),clearTimeout(s),t(e)}},e.prototype.close=function(){this.connection.close()},e.prototype.createRoom=function(e,t){return void 0===t&&(t={}),new s.Room(e,t)},e.prototype.createRoomRequest=function(e,t,n,r){var o=this;t.requestId=++this.requestId;var s=n||this.createRoom(e,t);return s.onLeave.addOnce(function(){delete o.rooms[s.id],delete o.connectingRooms[t.requestId]}),t.retryTimes&&s.onError.addOnce(function(){r=r||0,!s.hasJoined&&r<=t.retryTimes&&(r++,o.createRoomRequest(e,t,s,r))}),this.connectingRooms[t.requestId]=s,this.connection.send([i.Protocol.JOIN_REQUEST,e,t]),s},e.prototype.connect=function(e,t){var n=this;void 0===t&&(t={}),this.id=e||"",this.connection=new o.Connection(this.buildEndpoint("",t)),this.connection.onmessage=this.onMessageCallback.bind(this),this.connection.onclose=function(e){return n.onClose.dispatch(e)},this.connection.onerror=function(e){return n.onError.dispatch(e)},this.connection.onopen=function(){n.id&&n.onOpen.dispatch()}},e.prototype.buildEndpoint=function(e,t){void 0===e&&(e=""),void 0===t&&(t={});var n=["colyseusid="+this.id];for(var r in t)t.hasOwnProperty(r)&&n.push(r+"="+t[r]);return this.hostname+"/"+e+"?"+n.join("&")},e.prototype.onMessageCallback=function(e){var t=new DataView(e.data),n=t.getUint8(0);if(n===i.Protocol.USER_ID)this.id=i.utf8Read(t,1),a.setItem("colyseusid",this.id),this.onOpen.dispatch();else if(n===i.Protocol.JOIN_REQUEST){var r=t.getUint8(1),o=this.connectingRooms[r];if(!o)return void console.warn("colyseus.js: client left room before receiving session id.");o.id=i.utf8Read(t,2),this.rooms[o.id]=o,o.connect(this.buildEndpoint(o.id,o.options)),delete this.connectingRooms[r]}else if(n===i.Protocol.JOIN_ERROR){var s=i.utf8Read(t,1);console.error("colyseus.js: server error:",s),this.onError.dispatch(s)}else i.Protocol.ROOM_LIST},e}();t.Client=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.add=function(e){return this.registerListener(e)},t}(o.OnceSignal);t.Signal=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(23).createBackoff,s="undefined"!=typeof WebSocket?WebSocket:n(24),a=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.url=t,this.protocols=n,this.reconnectEnabled=!0,this.listeners={},this.backoff=i(o.backoff||"exponential",o),this.backoff.onReady=this.onBackoffReady.bind(this),(void 0===o.connect||o.connect)&&this.open()}return o(e,[{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isReconnect=e;var t=this.ws&&this.ws.binaryType;this.ws=new s(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),t&&(this.ws.binaryType=t)}},{key:"onBackoffReady",value:function(e,t){this.open(!0)}},{key:"onCloseCallback",value:function(e){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&e.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}},{key:"onMessageCallback",value:function(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}},{key:"onOpenCallback",value:function(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}},{key:"close",value:function(e,t){void 0===e&&(e=1e3),this.reconnectEnabled=!1,this.ws.close(e,t)}},{key:"send",value:function(e){this.ws.send(e)}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(e){this.ws.binaryType=e}},{key:"extensions",get:function(){return this.ws.extensions},set:function(e){this.ws.extensions=e}},{key:"protocol",get:function(){return this.ws.protocol},set:function(e){this.ws.protocol=e}},{key:"onclose",set:function(e){this.listeners.onclose=e},get:function(){return this.listeners.onclose}},{key:"onerror",set:function(e){this.listeners.onerror=e},get:function(){return this.listeners.onerror}},{key:"onmessage",set:function(e){this.listeners.onmessage=e},get:function(){return this.listeners.onmessage}},{key:"onopen",set:function(e){this.listeners.onopen=e},get:function(){return this.listeners.onopen}},{key:"onreconnect",set:function(e){this.listeners.onreconnect=e},get:function(){return this.listeners.onreconnect}}]),e}();a.CONNECTING=s.CONNECTING,a.OPEN=s.OPEN,a.CLOSING=s.CLOSING,a.CLOSED=s.CLOSED,t.default=a},function(e,t,n){"use strict";function r(e,t){return new o(i[e],t)}function o(e,t){this.func=e,this.attempts=0,this.delay=void 0!==t.initialDelay?t.initialDelay:100}Object.defineProperty(t,"__esModule",{value:!0}),t.createBackoff=r;var i={exponential:function(e,t){return Math.floor(Math.random()*Math.pow(2,e)*t)},fibonacci:function(e,t){var n=1;if(e>n)for(var r=1,n=2,o=2;o<e;o++){var i=r+n;r=n,n=i}return Math.floor(Math.random()*n*t)}};o.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(e,t){},function(e,t,n){"use strict";function r(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function o(e,t,n){for(var r="",o=0,i=t,s=t+n;i<s;i++){var a=e.getUint8(i);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));o=(7&a)<<18|(63&e.getUint8(++i))<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0,o>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++i))<<6|(63&e.getUint8(++i))<<0);else r+=String.fromCharCode((31&a)<<6|63&e.getUint8(++i));else r+=String.fromCharCode(a)}return r}function i(e){var t=new r(e),n=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return n}r.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t},r.prototype._map=function(e){for(var t="",n={},r=0;r<e;r++)t=this._parse(),n[t]=this._parse();return n},r.prototype._str=function(e){var t=o(this._view,this._offset,e);return this._offset+=e,t},r.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},r.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),n=0,r=0,o=0,i=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:return n=this._view.getUint8(this._offset),r=this._view.getInt8(this._offset+1),this._offset+=2,[r,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),r=this._view.getInt8(this._offset+2),this._offset+=3,[r,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),r=this._view.getInt8(this._offset+4),this._offset+=5,[r,this._bin(n)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,o+i;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,o+i;case 212:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?void(this._offset+=1):[r,this._bin(1)];case 213:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(2)];case 214:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(4)];case 215:return r=this._view.getInt8(this._offset),this._offset+=1,0===r?(o=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+i)):[r,this._bin(8)];case 216:return r=this._view.getInt8(this._offset),this._offset+=1,[r,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},e.exports=i},function(e,t,n){"use strict";function r(e,t,n){for(var r=0,o=0,i=n.length;o<i;o++)r=n.charCodeAt(o),r<128?e.setUint8(t++,r):r<2048?(e.setUint8(t++,192|r>>6),e.setUint8(t++,128|63&r)):r<55296||r>=57344?(e.setUint8(t++,224|r>>12),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r)):(o++,r=65536+((1023&r)<<10|1023&n.charCodeAt(o)),e.setUint8(t++,240|r>>18),e.setUint8(t++,128|r>>12&63),e.setUint8(t++,128|r>>6&63),e.setUint8(t++,128|63&r))}function o(e){for(var t=0,n=0,r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function i(e,t,n){var r=typeof n,s=0,a=0,u=0,c=0,f=0,h=0;if("string"===r){if((f=o(n))<32)e.push(160|f),h=1;else if(f<256)e.push(217,f),h=2;else if(f<65536)e.push(218,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("String too long");e.push(219,f>>24,f>>16,f>>8,f),h=5}return t.push({_str:n,_length:f,_offset:e.length}),h+f}if("number"===r)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(e.push(n),1):n<256?(e.push(204,n),2):n<65536?(e.push(205,n>>8,n),3):n<4294967296?(e.push(206,n>>24,n>>16,n>>8,n),5):(u=n/Math.pow(2,32)>>0,c=n>>>0,e.push(207,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),9):n>=-32?(e.push(n),1):n>=-128?(e.push(208,n),2):n>=-32768?(e.push(209,n>>8,n),3):n>=-2147483648?(e.push(210,n>>24,n>>16,n>>8,n),5):(u=Math.floor(n/Math.pow(2,32)),c=n>>>0,e.push(211,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),9):(e.push(203),t.push({_float:n,_length:8,_offset:e.length}),9);if("object"===r){if(null===n)return e.push(192),1;if(Array.isArray(n)){if((f=n.length)<16)e.push(144|f),h=1;else if(f<65536)e.push(220,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Array too large");e.push(221,f>>24,f>>16,f>>8,f),h=5}for(s=0;s<f;s++)h+=i(e,t,n[s]);return h}if(n instanceof Date){var l=n.getTime();return u=Math.floor(l/Math.pow(2,32)),c=l>>>0,e.push(215,0,u>>24,u>>16,u>>8,u,c>>24,c>>16,c>>8,c),10}if(n instanceof ArrayBuffer){if((f=n.byteLength)<256)e.push(196,f),h=2;else if(f<65536)e.push(197,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Buffer too large");e.push(198,f>>24,f>>16,f>>8,f),h=5}return t.push({_bin:n,_length:f,_offset:e.length}),h+f}if("function"==typeof n.toJSON)return i(e,t,n.toJSON());var p=[],d="",v=Object.keys(n);for(s=0,a=v.length;s<a;s++)d=v[s],"function"!=typeof n[d]&&p.push(d);if((f=p.length)<16)e.push(128|f),h=1;else if(f<65536)e.push(222,f>>8,f),h=3;else{if(!(f<4294967296))throw new Error("Object too large");e.push(223,f>>24,f>>16,f>>8,f),h=5}for(s=0;s<f;s++)d=p[s],h+=i(e,t,d),h+=i(e,t,n[d]);return h}if("boolean"===r)return e.push(n?195:194),1;if("undefined"===r)return e.push(212,0,0),3;throw new Error("Could not encode")}function s(e){var t=[],n=[],o=i(t,n,e),s=new ArrayBuffer(o),a=new DataView(s),u=0,c=0,f=-1;n.length>0&&(f=n[0]._offset);for(var h,l=0,p=0,d=0,v=t.length;d<v;d++)if(a.setUint8(c+d,t[d]),d+1===f){if(h=n[u],l=h._length,p=c+f,h._bin)for(var y=new Uint8Array(h._bin),_=0;_<l;_++)a.setUint8(p+_,y[_]);else h._str?r(a,p,h._str):void 0!==h._float&&a.setFloat64(p,h._float);u++,c+=l,n[u]&&(f=n[u]._offset)}return s}e.exports=s},function(e,t,n){"use strict";function r(){return s||(s="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]}}),s}function o(e,t){r().setItem(e,t)}function i(e,t){var n=r().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then(function(e){return t(e)}):t(n)}Object.defineProperty(t,"__esModule",{value:!0});var s;t.setItem=o,t.getItem=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=n(31),i=n(0),s=function(){function e(){this.api=new r.StateContainer({})}return e.prototype.getStateAPI=function(){return this.api},e.prototype.getState=function(){return this.api.state},e.prototype.setState=function(e){this.previousState=new Uint8Array(e),this.api.set(i.decode(this.previousState))},e.prototype.patch=function(e){this.previousState=new Uint8Array(o.apply(this.previousState,e)),this.api.set(i.decode(this.previousState))},e.prototype.removeAllListeners=function(){this.api.removeAllListeners()},e}();t.FossilDeltaSerializer=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),o=function(){function e(e){this.listeners=[],this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/},this.state=e,this.reset()}return e.prototype.set=function(e){var t=r.compare(this.state,e);return this.state=e,this.checkPatches(t,this.listeners,this.defaultListener),t},e.prototype.registerPlaceholder=function(e,t){this.matcherPlaceholders[e]=t},e.prototype.listen=function(e,t,n){var o,i=this;"function"==typeof e?(o=[],t=e):o=e.split("/"),t.length>1&&console.warn(".listen() accepts only one parameter.");var s={callback:t,rawRules:o,rules:o.map(function(e){return"string"==typeof e?0===e.indexOf(":")?i.matcherPlaceholders[e]||i.matcherPlaceholders[":*"]:new RegExp("^"+e+"$"):e})};return 0===o.length?this.defaultListener=s:this.listeners.push(s),n&&this.checkPatches(r.compare({},this.state),[s]),s},e.prototype.removeListener=function(e){for(var t=this.listeners.length-1;t>=0;t--)this.listeners[t]===e&&this.listeners.splice(t,1)},e.prototype.removeAllListeners=function(){this.reset()},e.prototype.checkPatches=function(e,t,n){for(var r=0,o=t.length;r<o;r++)for(var i=t[r],s=e.length-1;s>=0;s--){var a=i&&this.getPathVariables(e[s],i);a&&(i.callback({path:a,rawPath:e[s].path,operation:e[s].operation,value:e[s].value}),e[s].matched=!0)}if(n)for(var s=e.length-1;s>=0;s--)e[s].matched||n.callback(e[s])},e.prototype.getPathVariables=function(e,t){if(e.path.length!==t.rules.length)return!1;for(var n={},r=0,o=t.rules.length;r<o;r++){var i=e.path[r].match(t.rules[r]);if(!i||0===i.length||i.length>2)return!1;":"===t.rawRules[r].substr(0,1)&&(n[t.rawRules[r].substr(1)]=i[1])}return n},e.prototype.reset=function(){this.listeners=[]},e}();t.StateContainer=o},function(e,t,n){"use strict";function r(e,t){var n=[];return s(e,t,n,[]),n}function o(e,t){var n=e.slice();return n.push(t),n}function i(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var o in e)e.hasOwnProperty(o)&&r.push(o);return r}function s(e,t,n,r){for(var a=i(t),u=i(e),c=!1,f=u.length-1;f>=0;f--){var h=u[f],l=e[h];if(!t.hasOwnProperty(h)||void 0===t[h]&&void 0!==l&&!1===Array.isArray(t))n.push({operation:"remove",path:o(r,h)}),c=!0;else{var p=t[h];"object"==typeof l&&null!=l&&"object"==typeof p&&null!=p?s(l,p,n,o(r,h)):l!==p&&n.push({operation:"replace",path:o(r,h),value:p,previousValue:l})}}if(c||a.length!=u.length)for(var f=a.length-1;f>=0;f--){var h=a[f];if(!e.hasOwnProperty(h)&&void 0!==t[h]){var p=t[h],d=o(r,h);"object"==typeof p&&null!=p&&s({},p,n,d),n.push({operation:"add",path:d,value:p})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.compare=r},function(e,t){!function(t,n){void 0!==e&&e.exports?e.exports=n():t.fossilDelta=n()}(this,function(){"use strict";function e(){this.a=0,this.b=0,this.i=0,this.z=new Array(s)}function t(e){this.a=e,this.pos=0}function n(){this.a=[]}function r(e){var t,n;for(t=1,n=64;e>=n;t++,n<<=6);return t}function o(e){for(var t=0,n=0,r=0,o=0,i=0,s=e.length;s>=16;)t=t+e[i+0]|0,n=n+e[i+1]|0,r=r+e[i+2]|0,o=o+e[i+3]|0,t=t+e[i+4]|0,n=n+e[i+5]|0,r=r+e[i+6]|0,o=o+e[i+7]|0,t=t+e[i+8]|0,n=n+e[i+9]|0,r=r+e[i+10]|0,o=o+e[i+11]|0,t=t+e[i+12]|0,n=n+e[i+13]|0,r=r+e[i+14]|0,o=o+e[i+15]|0,i+=16,s-=16;for(;s>=4;)t=t+e[i+0]|0,n=n+e[i+1]|0,r=r+e[i+2]|0,o=o+e[i+3]|0,i+=4,s-=4;switch(o=((o+(r<<8)|0)+(n<<16)|0)+(t<<24)|0,s){case 3:o=o+(e[i+2]<<8)|0;case 2:o=o+(e[i+1]<<16)|0;case 1:o=o+(e[i+0]<<24)|0}return o>>>0}var i={},s=16;e.prototype.init=function(e,t){var n,r,o=0,i=0;for(n=0;n<s;n++)r=e[t+n],o=o+r&65535,i=i+(s-n)*r&65535,this.z[n]=r;this.a=65535&o,this.b=65535&i,this.i=0},e.prototype.next=function(e){var t=this.z[this.i];this.z[this.i]=e,this.i=this.i+1&s-1,this.a=this.a-t+e&65535,this.b=this.b-s*t+this.a&65535},e.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map(function(e){return e.charCodeAt(0)}),u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];return t.prototype.haveBytes=function(){return this.pos<this.a.length},t.prototype.getByte=function(){var e=this.a[this.pos];if(++this.pos>this.a.length)throw new RangeError("out of bounds");return e},t.prototype.getChar=function(){return String.fromCharCode(this.getByte())},t.prototype.getInt=function(){for(var e,t=0;this.haveBytes()&&(e=u[127&this.getByte()])>=0;)t=(t<<6)+e;return this.pos--,t>>>0},n.prototype.toArray=function(){return this.a},n.prototype.putByte=function(e){this.a.push(255&e)},n.prototype.putChar=function(e){this.putByte(e.charCodeAt(0))},n.prototype.putInt=function(e){var t,n,r=[];if(0===e)return void this.putChar("0");for(t=0;e>0;t++,e>>>=6)r.push(a[63&e]);for(n=t-1;n>=0;n--)this.putByte(r[n])},n.prototype.putArray=function(e,t,n){for(var r=t;r<n;r++)this.a.push(e[r])},i.create=function(t,i){var a,u=new n,c=i.length,f=t.length,h=-1;if(u.putInt(c),u.putChar("\n"),f<=s)return u.putInt(c),u.putChar(":"),u.putArray(i,0,c),u.putInt(o(i)),u.putChar(";"),u.toArray();var l=Math.ceil(f/s),p=new Array(l),d=new Array(l);for(a=0;a<p.length;a++)p[a]=-1;for(a=0;a<d.length;a++)d[a]=-1;var v,y=new e;for(a=0;a<f-s;a+=s)y.init(t,a),v=y.value()%l,p[a/s]=d[v],d[v]=a/s;for(var _,m,g,w,b,O=0;O+s<c;)for(w=0,b=0,y.init(i,O),a=0,g=0;;){var E=250;for(v=y.value()%l,m=d[v];m>=0&&E-- >0;){var A,C,P,S,R,I,j,k;for(_=m*s,S=0,I=_,j=O+a;I<f&&j<c&&t[I]===i[j];S++,I++,j++);for(S--,R=1;R<_&&R<=a&&t[_-R]===i[O+a-R];R++);R--,C=_-R,A=S+R+1,P=a-R,k=r(a-R)+r(A)+r(C)+3,A>=k&&A>g&&(g=A,w=_-R,b=P),m=p[m]}if(g>0){b>0&&(u.putInt(b),u.putChar(":"),u.putArray(i,O,O+b),O+=b),O+=g,u.putInt(g),u.putChar("@"),u.putInt(w),u.putChar(","),w+g-1>h&&(h=w+g-1),g=0;break}if(O+a+s>=c){u.putInt(c-O),u.putChar(":"),u.putArray(i,O,O+c-O),O=c;break}y.next(i[O+a+s]),a++}return O<c&&(u.putInt(c-O),u.putChar(":"),u.putArray(i,O,O+c-O)),u.putInt(o(i)),u.putChar(";"),u.toArray()},i.outputSize=function(e){var n=new t(e),r=n.getInt();if("\n"!==n.getChar())throw new Error("size integer not terminated by '\\n'");return r},i.apply=function(e,r,i){var s,a=0,u=new t(r),c=e.length,f=r.length;if(s=u.getInt(),"\n"!==u.getChar())throw new Error("size integer not terminated by '\\n'");for(var h=new n;u.haveBytes();){var l,p;switch(l=u.getInt(),u.getChar()){case"@":if(p=u.getInt(),u.haveBytes()&&","!==u.getChar())throw new Error("copy command not terminated by ','");if((a+=l)>s)throw new Error("copy exceeds output file size");if(p+l>c)throw new Error("copy extends past end of input");h.putArray(e,p,p+l);break;case":":if((a+=l)>s)throw new Error("insert command gives an output larger than predicted");if(l>f)throw new Error("insert count exceeds size of delta");h.putArray(u.a,u.pos,u.pos+l),u.pos+=l;break;case";":var d=h.toArray();if((!i||!1!==i.verifyChecksum)&&l!==o(d))throw new Error("bad checksum");if(a!==s)throw new Error("generated size does not match predicted size");return d;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")},i})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=function(){function e(){}return e.prototype.setState=function(e){this.api.decode(e)},e.prototype.getState=function(){return this.api},e.prototype.patch=function(e){this.api.decode(e)},e.prototype.removeAllListeners=function(){},e.prototype.handshake=function(e){this.api=r.Reflection.decode(e)},e}();t.SchemaSerializer=o},function(e,t,n){"use strict";function r(e,t,n){var r=c[e];return!!r&&(r(t,n),!0)}function o(e,t,n){var r=f[e];return r?r(t,n):null}function i(e){return function(t,n){var r=t.constructor;r._schema||(r._schema={},r._indexes={}),r._indexes[n]=Object.keys(r._schema).length,r._schema[n]=e;var o=Array.isArray(e),i=!o&&e.map,s="_"+n;Object.defineProperty(t,s,{enumerable:!1,configurable:!1,writable:!0}),Object.defineProperty(t,n,{get:function(){return this[s]},set:function(e){var t=this;if((o||i)&&(e=new Proxy(e,{get:function(e,t){return e[t]},set:function(e,r,a){if("length"!==r){var u=o?Number(r):String(r);if(a.$parentField&&a.$parentField[1]!==u)if(i){var c=t[""+s]._indexes[a.$parentField[1]];a.$parentIndexChange=c}else a.$parentIndexChange=a.$parentField[1];a instanceof p?(a.$parent=t,a.$parentField=[n,u],t.markAsChanged(n,a)):(e[r]=a,t.markAsChanged(n,e))}else e[r];return e[r]=a,!0},deleteProperty:function(e,t){var r=e[t];return delete e[t],r&&r.$parent&&r.$parent.markAsChanged(n,r),!0}})),e!==this[s])if(this[s]=e,Array.isArray(r._schema[n])){var a=e.length;if(0===a)return void this.markAsChanged(n,{$parentField:[n]});for(var u=0;u<a;u++)e[u]instanceof p&&(e[u].$parent=this,e[u].$parentField=[n,u]),this.markAsChanged(n,e[u])}else if(r._schema[n].map)for(var c in e)e[c]instanceof p?(e[c].$parent=this,e[c].$parentField=[n,c],this.markAsChanged(n,e[c])):this.markAsChanged(n,c);else"function"==typeof r._schema[n]?(e.$parent=this,e.$parentField=n,this.markAsChanged(n,e)):this.markAsChanged(n,e)},enumerable:!0,configurable:!1})}}var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var u=n(14),c=n(34),f=n(35),h=n(13),l=n(12),p=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$allChanges={},this.$changes={},this.$changed=!1}return e.prototype.markAsChanged=function(e,t){var n=this._schema[e];if(this.$changed=!0,void 0!==t)if(Array.isArray(t.$parentField)||n&&(Array.isArray(n)||n.map)){var r=t.$parentField||[],o=r.length>0?r[0]:e,i=r.length>0?r[1]:t;this.$changes[o]||(this.$changes[o]=[]),this.$allChanges[o]||(this.$allChanges[o]=[]),void 0!==i&&(-1===this.$changes[o].indexOf(i)&&this.$changes[o].push(i),-1===this.$allChanges[o].indexOf(i)&&this.$allChanges[o].push(i))}else t.$parentField?(this.$changes[t.$parentField]=t,this.$allChanges[t.$parentField]=t):(this.$changes[e]=this["_"+e],this.$allChanges[e]=this["_"+e]);this.$parent&&this.$parent.markAsChanged(e,this)},Object.defineProperty(e.prototype,"_schema",{get:function(){return this.constructor._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_indexes",{get:function(){return this.constructor._indexes},enumerable:!0,configurable:!0}),e.prototype.decode=function(t,n){void 0===n&&(n={offset:0});var r=[],i=this._schema,s=this._indexes,a={};Object.keys(s).forEach(function(e){var t=s[e];a[t]=e});for(var c=t.length,p=this;n.offset<c;){if("break"===function(){var s=t[n.offset++],c=a[s];if(s===u.END_OF_STRUCTURE)return"break";var d=i[c],v=void 0,y=void 0,_=!1;if(d._schema)v=p["_"+c]||new d,v.$parent=p,v.decode(t,n),_=!0;else if(Array.isArray(d)){d=d[0],y=[];var m=p["_"+c]||new h.ArraySchema;v=m.clone();var g=f.number(t,n),w=f.number(t,n);_=w>0;var b=!1;v.length>g&&v.splice(g).forEach(function(e,t){e.onRemove&&e.onRemove(),m.onRemove&&m.onRemove(e,g+t)});for(var O=0;O<w;O++){var E=f.number(t,n),A=void 0;if(f.indexChangeCheck(t,n)&&(f.uint8(t,n),A=f.number(t,n),b=!0),d.prototype instanceof e){var C=void 0,P=b&&void 0===A&&void 0!==E;if(P?C=new d:void 0!==A?C=m[A]:void 0!==E&&(C=m[E]),C||(C=new d,P=!0),f.nilCheck(t,n)){n.offset++,m.onRemove&&m.onRemove(C,E);continue}C.$parent=p,C.decode(t,n),P&&m.onAdd&&m.onAdd(C,E),v[E]=C}else v[E]=o(d,t,n);y.push(v[E])}}else if(d.map){d=d.map;var S=p["_"+c]||new l.MapSchema;v=S.clone();var R=f.number(t,n);_=R>0;for(var b=!1,I=Object.keys(S),O=0;O<R&&(void 0!==t[n.offset]&&t[n.offset]!==u.END_OF_STRUCTURE);O++){var j=void 0;f.indexChangeCheck(t,n)&&(f.uint8(t,n),j=I[f.number(t,n)],b=!0);var k=f.numberCheck(t,n),T=k?I[f.number(t,n)]:f.string(t,n),C=void 0,P=b&&void 0===j&&k;C=b&&void 0===j&&k?new d:void 0!==j?S[j]:S[T],C||"string"===d||(C=new d,P=!0),f.nilCheck(t,n)?(n.offset++,C&&C.onRemove&&C.onRemove(),S.onRemove&&S.onRemove(C,T),delete v[T]):"string"===d?v[T]=o(d,t,n):(C.$parent=p,C.decode(t,n),v[T]=C,P&&S.onAdd?S.onAdd(C,T):S.onChange&&S.onChange(C,T))}}else v=o(d,t,n),_=!0;_&&p.onChange&&r.push({field:c,value:y||v,previousValue:p["_"+c]}),p["_"+c]=v}())break}return this.onChange&&r.length>0&&this.onChange(r),this},e.prototype.encode=function(t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var o=[],i=function(){t||o.push(u.END_OF_STRUCTURE)};if(!this.$changed&&!n)return i(),o;var s=this._schema,a=this._indexes,f=n?this.$allChanges:this.$changes;for(var h in f){var l=[],p=s[h],d=f[h],v=a[h];if(void 0!==d){if(p._schema)c.number(l,v),l=l.concat(d.encode(!1,n)),d.$parent||(d.$parent=this,d.$parentField=h);else if(Array.isArray(p)){c.number(l,v),c.number(l,this["_"+h].length),c.number(l,d.length);for(var y=0,_=d.length;y<_;y++){var m=d[y],g=this["_"+h][m];if("string"!=typeof p[0]){if(c.number(l,m),void 0===g){c.uint8(l,u.NIL);continue}g.$parentIndexChange>=0&&(c.uint8(l,u.INDEX_CHANGE),c.number(l,g.$parentIndexChange),g.$parentIndexChange=void 0),g.$parent||(g.$parent=this,g.$parentField=[h,y]),l=l.concat(g.encode(!1,n))}else if(c.number(l,y),!r(p[0],l,m)){console.log("cannot encode",s[h]);continue}}}else if(p.map){c.number(l,v);var w=d;c.number(l,w.length);for(var b=Object.keys(this["_"+h]),y=0;y<w.length;y++){var O=b[w[y]]||w[y],g=this["_"+h][O],E=this["_"+h]._indexes[O];if(n){if(!g)continue;E=void 0}if(g&&g.$parentIndexChange>=0&&(c.uint8(l,u.INDEX_CHANGE),c.number(l,g.$parentIndexChange),g.$parentIndexChange=void 0),void 0!==E)c.number(l,E);else{c.string(l,O);var A=b.indexOf(O);A>=0&&(this["_"+h]._indexes[O]=A)}g instanceof e?(g.$parent=this,g.$parentField=[h,w[y]],l=l.concat(g.encode(!1,n))):void 0!==g?r(p.map,l,g):c.uint8(l,u.NIL)}this["_"+h]._updateIndexes()}else if(c.number(l,v),!r(p,l,d)){console.log("cannot encode",s[h]);continue}o=o.concat(l)}}return i(),this.$changed=!1,this.$changes={},o},e.prototype.encodeAll=function(){return this.encode(!0,!0)},e.prototype.toJSON=function(){var e=this._schema,t={};for(var n in e)t[n]=this["_"+n];return t},e}();t.Schema=p;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),a([i("string")],t.prototype,"name",void 0),a([i("string")],t.prototype,"type",void 0),a([i("number")],t.prototype,"referencedType",void 0),t}(p);t.ReflectionField=d;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=new h.ArraySchema,t}return s(t,e),a([i("uint8")],t.prototype,"id",void 0),a([i([d])],t.prototype,"fields",void 0),t}(p);t.ReflectionType=v;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.types=new h.ArraySchema,t}return s(t,e),t.encode=function(e){var n=new t,r=e._schema,o=0,i=new v;i.id=o++;var s={},a=function(e,t){for(var r in t){var i=new d;i.name=r;var u=void 0;if("string"==typeof t[r])u=t[r];else{var c="function"==typeof t[r],f=Array.isArray(t[r]);u=f?"array":c?"ref":"map";var h=f?t[r][0]:c?t[r]:t[r].map,l=h.name;if(void 0===s[l]){var p=new v;p.id=o++,s[l]=p.id,a(p,(new h)._schema)}i.referencedType=s[l]}i.type=u,e.fields.push(i)}n.types.push(e)};return a(i,r),n.encodeAll()},t.decode=function(e){var n=new t;n.decode(e);var r=n.types.reverse().map(function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(p)});n.types.forEach(function(e,t){e.fields.forEach(function(e){var n=r[t];if(void 0!==e.referencedType){var o=r[e.referencedType];"array"===e.type?i([o])(n.prototype,e.name):"map"===e.type?i({map:o})(n.prototype,e.name):"ref"===e.type&&i(o)(n.prototype,e.name)}else i(e.type)(n.prototype,e.name)})});var o=new r[0];for(var a in o._schema){var u=o._schema[a];if("string"!=typeof u){var c="function"==typeof u,f=Array.isArray(u),d=!f&&u.map;o[a]=f?new h.ArraySchema:d?new l.MapSchema:c?new u:void 0}}return o},a([i([v])],t.prototype,"types",void 0),t}(p);t.Reflection=y,t.type=i},function(e,t,n){"use strict";function r(e){for(var t=0,n=0,r=0,o=e.length;r<o;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}function o(e,t,n){for(var r=0,o=0,i=n.length;o<i;o++)r=n.charCodeAt(o),r<128?e[t++]=r:r<2048?(e[t++]=192|r>>6,e[t++]=128|63&r):r<55296||r>=57344?(e[t++]=224|r>>12,e[t++]=128|r>>6&63,e[t++]=128|63&r):(o++,r=65536+((1023&r)<<10|1023&n.charCodeAt(o)),e[t++]=240|r>>18,e[t++]=128|r>>12&63,e[t++]=128|r>>6&63,e[t++]=128|63&r)}function i(e,t){e.push(t)}function s(e,t){e.push(t)}function a(e,t){e.push(t),e.push(t>>8)}function u(e,t){e.push(t),e.push(t>>8)}function c(e,t){e.push(t),e.push(t>>8),e.push(t>>16),e.push(t>>24)}function f(e,t){e.push(t),e.push(t>>8),e.push(t>>16),e.push(t>>24)}function h(e,t){c(e,t.low),c(e,t.high)}function l(e,t){f(e,t.low),f(e,t.high)}function p(e,t){v(e,t)}function d(e,t){y(e,t)}function v(e,t){O[0]=t,c(e,b[0])}function y(e,t){E[0]=t,c(e,b[w?0:1]),c(e,b[w?1:0])}function _(e,t){return s(e,t?1:0)}function m(e,t){var n=r(t),i=0;if(n<32)e.push(160|n),i=1;else if(n<256)e.push(217,n),i=2;else if(n<65536)e.push(218,n>>8,n),i=3;else{if(!(n<4294967296))throw new Error("String too long");e.push(219,n>>24,n>>16,n>>8,n),i=5}return o(e,e.length,t),i+n}function g(e,t){return Math.floor(t)===t&&isFinite(t)?t>=0?t<128?(s(e,t),1):t<256?(e.push(204),s(e,t),2):t<65536?(e.push(205),u(e,t),3):t<4294967296?(e.push(206),f(e,t),5):(e.push(207),l(e,t),9):t>=-32?(e.push(t),1):t>=-128?(e.push(208),i(e,t),2):t>=-32768?(e.push(209),a(e,t),3):t>=-2147483648?(e.push(210),c(e,t),5):(e.push(211),h(e,t),9):(e.push(203),y(e,t),9)}Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Write=o,t.int8=i,t.uint8=s,t.int16=a,t.uint16=u,t.int32=c,t.uint32=f,t.int64=h,t.uint64=l,t.float32=p,t.float64=d;var w=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],b=new Int32Array(2),O=new Float32Array(b.buffer),E=new Float64Array(b.buffer);t.writeFloat32=v,t.writeFloat64=y,t.boolean=_,t.string=m,t.number=g},function(e,t,n){"use strict";function r(e,t,n){for(var r="",o=0,i=t,s=t+n;i<s;i++){var a=e[i];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));o=(7&a)<<18|(63&e[++i])<<12|(63&e[++i])<<6|(63&e[++i])<<0,o>=65536?(o-=65536,r+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):r+=String.fromCharCode(o)}else r+=String.fromCharCode((15&a)<<12|(63&e[++i])<<6|(63&e[++i])<<0);else r+=String.fromCharCode((31&a)<<6|63&e[++i]);else r+=String.fromCharCode(a)}return r}function o(e,t,n){var o=r(e,t.offset,n);return t.offset+=n,o}function i(e,t){return s(e,t)<<24>>24}function s(e,t){return e[t.offset++]}function a(e,t){return u(e,t)<<16>>16}function u(e,t){return e[t.offset++]|e[t.offset++]<<8}function c(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function f(e,t){return c(e,t)>>>0}function h(e,t){return p(e,t)}function l(e,t){return d(e,t)}function p(e,t){return C[0]=c(e,t),P[0]}function d(e,t){return C[A?0:1]=c(e,t),C[A?1:0]=c(e,t),S[0]}function v(e,t){return s(e,t)>0}function y(e,t){return o(e,t,31&e[t.offset++])}function _(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}function m(e,t){var n=e[t.offset++];if(n<128)return n;if(202===n){var r=e[t.offset];return t.offset+=4,r}if(202===n)return p(e,t);if(203===n)return d(e,t);if(204===n)return s(e,t);if(205===n)return u(e,t);if(206===n)return f(e,t);if(207===n){var o=e[t.offset]*Math.pow(2,32),h=e[t.offset+4];return t.offset+=8,o+h}if(208===n)return i(e,t);if(209===n)return a(e,t);if(210===n)return c(e,t);if(211===n){var o=e[t.offset]*Math.pow(2,32),h=e[t.offset+4];return t.offset+=8,o+h}return n>223?-1*(255-n+1):void 0}function g(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}function w(e,t){return e[t.offset]<160}function b(e,t){return e[t.offset]===E.NIL}function O(e,t){return e[t.offset]===E.INDEX_CHANGE}Object.defineProperty(t,"__esModule",{value:!0});var E=n(14);t.int8=i,t.uint8=s,t.int16=a,t.uint16=u,t.int32=c,t.uint32=f,t.float32=h,t.float64=l;var A=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],C=new Int32Array(2),P=new Float32Array(C.buffer),S=new Float64Array(C.buffer);t.readFloat32=p,t.readFloat64=d,t.boolean=v,t.string=y,t.stringCheck=_,t.number=m,t.numberCheck=g,t.arrayCheck=w,t.nilCheck=b,t.indexChangeCheck=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=n(37),i=function(){function e(){this.api=new r.StateContainer({})}return e.prototype.setState=function(e){this.rawState=e,this.api.set(this.rawState)},e.prototype.getState=function(){return this.api.state},e.prototype.patch=function(e){this.setState(o.applyPatch(this.rawState,e).newDocument)},e.prototype.removeAllListeners=function(){this.api.removeAllListeners()},e}();t.JSONPatchSerializer=i},function(e,t,n){function r(e){return v.get(e)}function o(e,t){return e.observers.get(t)}function i(e,t){e.observers.delete(t.callback)}function s(e,t){t.unobserve()}function a(e,t){var n,s=[],a=r(e);if(a){var c=o(a,t);n=c&&c.observer}else a=new y(e),v.set(e,a);if(n)return n;if(n={},a.value=h._deepClone(e),t){n.callback=t,n.next=null;var f=function(){u(n)},l=function(){clearTimeout(n.next),n.next=setTimeout(f)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",l),window.addEventListener("keyup",l),window.addEventListener("mousedown",l),window.addEventListener("keydown",l),window.addEventListener("change",l)):(document.documentElement.attachEvent("onmouseup",l),document.documentElement.attachEvent("onkeyup",l),document.documentElement.attachEvent("onmousedown",l),document.documentElement.attachEvent("onkeydown",l),document.documentElement.attachEvent("onchange",l)))}return n.patches=s,n.object=e,n.unobserve=function(){u(n),clearTimeout(n.next),i(a,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",l),window.removeEventListener("keyup",l),window.removeEventListener("mousedown",l),window.removeEventListener("keydown",l)):(document.documentElement.detachEvent("onmouseup",l),document.documentElement.detachEvent("onkeyup",l),document.documentElement.detachEvent("onmousedown",l),document.documentElement.detachEvent("onkeydown",l)))},a.observers.set(t,new _(t,n)),n}function u(e){var t=v.get(e.object);c(t.value,e.object,e.patches,""),e.patches.length&&l.applyPatch(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function c(e,t,n,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var o=h._objectKeys(t),i=h._objectKeys(e),s=!1,a=i.length-1;a>=0;a--){var u=i[a],f=e[u];if(!h.hasOwnProperty(t,u)||void 0===t[u]&&void 0!==f&&!1===Array.isArray(t))n.push({op:"remove",path:r+"/"+h.escapePathComponent(u)}),s=!0;else{var l=t[u];"object"==typeof f&&null!=f&&"object"==typeof l&&null!=l?c(f,l,n,r+"/"+h.escapePathComponent(u)):f!==l&&(!0,n.push({op:"replace",path:r+"/"+h.escapePathComponent(u),value:h._deepClone(l)}))}}if(s||o.length!=i.length)for(var a=0;a<o.length;a++){var u=o[a];h.hasOwnProperty(e,u)||void 0===t[u]||n.push({op:"add",path:r+"/"+h.escapePathComponent(u),value:h._deepClone(t[u])})}}}function f(e,t){var n=[];return c(e,t,n,""),n}var h=(n(15),n(2)),l=n(16),p=n(16);t.applyOperation=p.applyOperation,t.applyPatch=p.applyPatch,t.applyReducer=p.applyReducer,t.getValueByPointer=p.getValueByPointer,t.validate=p.validate,t.validator=p.validator;var d=n(2);t.JsonPatchError=d.PatchError,t.deepClone=d._deepClone,t.escapePathComponent=d.escapePathComponent,t.unescapePathComponent=d.unescapePathComponent;var v=new WeakMap,y=function(){function e(e){this.observers=new Map,this.obj=e}return e}(),_=function(){function e(e,t){this.callback=e,this.observer=t}return e}();t.unobserve=s,t.observe=a,t.generate=u,t.compare=f},function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}t=e.exports="function"==typeof Object.keys?Object.keys:n,t.shim=n},function(e,t){function n(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function r(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}var o="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();t=e.exports=o?n:r,t.supported=n,t.unsupported=r},function(e,t,n){"use strict";function r(e,t,n,r,o){"var"===t.holderType?e[n]=r:"key"===t.holderType&&(e[n]=o)}function o(e,t,n,o){for(var i in t)t.hasOwnProperty(i)&&r(e,t[i],i,n[i],o)}function i(e,t,n){void 0===n&&(n=0);for(var r=e,o=0,i=t.length;o<i+n&&"object"==typeof r[t[o]];o++)r=r[t[o]];return r}function s(e,t,n,r,o){return function(o){if("add"===o.operation){var i=new t.type;for(var s in o.value)o.value.hasOwnProperty(s)&&(i[s]=o.value[s]);c.bindListeners(t.type.listeners,e,i),n[t.variable]=i,t.addCallback&&t.addCallback.call(r,r,i,o)}else"replace"===o.operation?r[this.rawRules[0]][t.variable]=o.value:"remove"===o.operation&&(t.removeCallback&&t.removeCallback.call(r,r,n[t.variable][o.path.id],o),delete n[t.variable])}}function a(e,t,n,s,a){return function(a){var u=i(s,a.rawPath);if("add"===a.operation){var f=new t.type;Object.defineProperty(f,"__mapParent",{configurable:!0,enumerable:!1,value:i(s,a.rawPath,-2),writable:!0}),c.bindListeners(t.type.listeners,e,f),u[a.path.id]=f,o(f,t.type.properties,a.value,a.path.id),t.addCallback&&t.addCallback.call(f.__mapParent,f.__mapParent,f,a)}else"replace"===a.operation?r(u,t,t.variable,a.value):"remove"===a.operation&&(t.removeCallback&&t.removeCallback.call(u.__mapParent,u.__mapParent,u,a),delete n[t.variable][a.path.id])}}function u(e,t,n,o,s){return function(e){var n=i(o,e.rawPath);"remove"!==e.operation?r(n,t,t.variable,e.value):"remove"===e.operation&&delete n[t.variable]}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(17);t.objectListener=s,t.mapListener=a,t.varListener=u}]);